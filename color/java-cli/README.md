## Color Sample App

The Color app illustrates the use of [Couchbase Lite Vector Search Library and API](https://docs.couchbase.com/couchbase-lite/3.2/swift/vector-search.html) to create a vector index and to perform vector similarity search for finding similar colors based on 3-dimensional color vectors.

### Overview ###

Each color can be encoded as a 3-dimension vectors or a set of three space separated numbers, with each value ranging from 0 to 255 or as a sharp sign ("#") followed by six hex digits. These three numbers correspond to the intensity of the Red (R), Green (G), and Blue (B) components that combine to create a color. For instance, the pink color is represented by `[255, 192, 203]` or `#FFC0CB` in hexadecimal format. With all possible combinations of the three numbers, the total number of colors generated is 16,581,375.

To find similar colors in the color space, enter the RGB spec of the color for which to search.  The app performs a similarity search based on the Euclidean distances calcuated between the search color and the database of available colors. The top 8 similar colors are returned. The app uses Couchbase Lite's Vector Index which performs the vector search efficently.

### Inside the App ###

#### Dataset ####

The app includes 153 documents in the `colors` collection of the `default` scope in the embedded Couchbase Lite database. Each document contains information about a color as shown in this example:

```
{
  "id": "#FFEFD5",
  "color": "papaya whip",
  "colorvect_l2": [255, 239, 213],
  "brightness": 240.82,
  "wheel_pos": "other",
  "verbs": ["soften", "mellow", "lighten"],
  "description": "Papaya whip is a soft ... ",
  "embedding_model": "text-embedding-ada-002-v2",
  "embedding_vector_dot": [ -0.014644118957221508, ... ]
}
```
The app uses 3 properties from the documents:

* 'id' : Color in hexadecimal format
* 'color' : Color name
* 'colorvect_l2' : Color in 3-dimension vector (3 RGB numbers). The vector embeddings are included inline in the document.

#### Building Vector Index ####

When running the app for the first time, the app will load a [prebuilt database](https://docs.couchbase.com/couchbase-lite/current/swift/prebuilt-database.html) containing the dataset as described above. The app will then create a vector index from the `colorvect_l2` property of the documents in the `colors` collection. As the dataset is pretty small, the app uses a small number of centroids (2) and opts to use no vector encoding to maximize accuracy and use less computation. Note that the Euclidean distance metric is selected by default. To learn more about vector index and tuning, check this [guide](https://github.com/couchbaselabs/mobile-vector-search/blob/main/docs/Tuning.md). 

This is relevant code snippet
```
final VectorIndexConfiguration config = new VectorIndexConfiguration("colorvect_l2", 3L, 2L);
config.setEncoding(VectorEncoding.none());
coll.createIndex("colors_index", config);
```

#### Running Similarity Search Query ####

The app accepts colors entered in three-number or hexadecimal format and searchs for similar colors. When searching, the app uses an SQL++ query with the `vector_match()` function against the created vector index. The top 8 KNN results are returned and displayed.

This is relevant code snippet
```
final Query q = db.createQuery(
    "SELECT id, color, colorvect_l2, APPROX_VECTOR_DISTANCE(colorvect_l2, $vector) as dist" +
        " FROM colors" +
        " ORDER BY APPROX_VECTOR_DISTANCE(colorvect_l2, $vector)" +
        " LIMIT 8");

final Parameters params = new Parameters();
params.setArray("vector", new MutableArray(color.getRGBVector()));
q.setParameters(params);

try (ResultSet rs = q.execute()) {
    // ...
}

```

#### The AI Model ####

In a real world application, the vector embeddings will be generated by the application by accessing a suitable AI embedding model. In the sample app, the documents with the vector embeddings are included in the prebuilt database. The vector corresponding to the search query would also be generated by the model. In this simple exmaple, user is expected to enter the RGB vector corresponding to the color to search.

### Prerequisites ###

To run this project, you will need:
* Java 17 or greater to do the build; Java 11 or greater to run the application

### Running the App ###

* Clone the repo
* Change directory to <repo>/color/java-cli
* Create the fat jar:  gradlew fatJar
* Run the app: java -jar build/libs/colors-1.0-SNAPSHOT.jar
* Enter a color code in HEX or RGB format to see similar colors

