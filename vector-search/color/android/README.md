## Color Sample App ##

 The Color app illustrates the use of [Couchbase Lite Vector Search Library and API](https://docs.couchbase.com/couchbase-lite/3.2/android/vector-search.html) to create a vector index and to perform vector similarity search for finding similar colors based on 3-dimensional color vectors.

### Overview ###

Each color can be encoded as a 3-dimension vectors or a set of three numbers, with each value ranging from 0 to 255. These three numbers correspond to the intensity of the Red (R), Green (G), and Blue (B) components that combine to create a color. For instance, the pink color is represented by `[255, 192, 203]` or `0xFFC0CB` in hexadecimal format. With all possible combinations of the three numbers, the total number of colors generated is 16,581,375.

 To find similar colors in the color space, users enter the RGB vector of a color to search and the app performs a similarity search based on the euclidean distances calculated between the search color and the database of available colors. The top 8 similar colors are returned. The app utilizes Couchbase Lite's Vector Index that allows the vector search to perform efficiently.

### Inside the App ###

#### Dataset ####

The app includes 153 documents in the `colors` collection of the `default` scope in the embedded Couchbase Lite database. Each document contains information about a color as shown in this example:

```
{
  "id": "#FFEFD5",
  "color": "papaya whip",
  "colorvect_l2": [255, 239, 213],
  "brightness": 240.82,
  "wheel_pos": "other",
  "verbs": ["soften", "mellow", "lighten"],
  "description": "Papaya whip is a soft ... ",
  "embedding_model": "text-embedding-ada-002-v2",
  "embedding_vector_dot": [ -0.014644118957221508, ... ]
}
```
The app uses 3 properties from the documents:

* 'id' : Color in hexadecimal format
* 'color' : Color name
* 'colorvect_l2' : Color in 3-dimension vector (3 RGB numbers).The vector embeddings are included inline in the document.

#### Building Vector Index ####

When running the app for the first time, the app will load a [prebuilt database](https://docs.couchbase.com/couchbase-lite/3.2/android/prebuilt-database.html) containing the dataset as described above. The app will then create a vector index from the `colorvect_l2` property of the documents in the `colors` collection. As the dataset is pretty small, the app uses a small number of centroids (2) and opts to use no vector encoding to maximize accuracy and use less computation. Note that the euclidean distance metric is selected by default. To learn more about vector index and tuning, check this [guide](https://github.com/couchbaselabs/mobile-vector-search/blob/main/docs/Tuning.md).

This is relevant code snippet
```
   val config = VectorIndexConfiguration("colorvect_l2", 3, 2)
   config.encoding = VectorEncoding.none()
   collection.createIndex("colors", config)
```

#### Running Similarity Search Query ####

The app lets users enter colors in three-number or hexadecimal format to search for similar colors. When searching, the app uses an SQL++ query with the `vector_match()` function against the created vector index. The top 8 KNN results are returned and displayed.
This is relevant code snippet

```
// Create the query object:
query = db.createQuery("""
    SELECT id, color, colorvect_l2, APPROX_VECTOR_DISTANCE(colorvect_l2, ${'$'}vector) as dist
        FROM colors
        ORDER BY APPROX_VECTOR_DISTANCE(colorvect_l2, ${'$'}vector)
        LIMIT 8
    """.trimIndent()
)

// Set $vector parameter on the query:
val params = Parameters()
params.setArray("vector", MutableArray(color))
query!!.parameters = params

// Execute the query:
query!!.execute().use { rs -> ... }
```
#### The AI Model ####

 In a real world application, the vector embeddings will be generated by the application by accessing a suitable AI embedding model. In the sample app, the documents with the vector embeddings are included in the prebuilt database. The vector corresponding to the search query would also be generated by the model. In this simple example, user is expected to enter the RGB vector corresponding to the color to search.
 
### Prerequisites ###

* Android Studio.  The project was built with Android Studio Jellyfish (2023.3.1 Patch 1)
* [Couchbase Lite Android 3.2.0](https://docs.couchbase.com/couchbase-lite/3.2/android/gs-install.html)
* [Couchbase Lite Vector Search 1.0.0](https://docs.couchbase.com/couchbase-lite/3.2/android/gs-install.html)

### Running the App ###

* Open `android` folder using Android Studio.
* Make sure that `gradle sync` is successfully done.
* Select your Android Emulator or device
* Run the app.
* Enter color code in HEX or RGB format and see similar matching colors

### Screenshot ###

<img src="images/screenshot.png" width="300"/>
